<?xml version="1.0"?>
<robot name="nexus_ags" xmlns:xacro="http://www.ros.org/wiki/xacro">

    <link name="world" />

    <!-- WORLD to BASE -->
    <joint name="world_joint" type="fixed">
        <parent link="world" />
        <child link="base_link" />
        <origin xyz="0 0 0" rpy="0 0 0" />
    </joint>
    <link name="base_link">
        <visual>
            <origin xyz="0 0 0.05" />
            <geometry>
                <box size="0.3 0.3 0.1" />
            </geometry>
            <material name="base">
                <color rgba="0.3 0.3 0.3 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0.05" />
            <geometry>
                <box size="0.3 0.3 0.1" />
            </geometry>
        </collision>
        <inertial>
            <origin xyz="0 0 0.05" />
            <mass value="50" />
            <inertia ixx="0.5" iyy="0.5" izz="0.5" ixy="0" ixz="0" iyz="0" />
        </inertial>
    </link>

    <!-- BASE to SHOULDER -->
    <joint name="shoulder_joint" type="revolute">
        <parent link="base_link" />
        <child link="shoulder_link" />
        <origin xyz="0 0 0.05" />
        <axis xyz="0 0 1" />
        <limit lower="-3.14" upper="3.14" effort="300" velocity="1" />
    </joint>
    <!-- JOINT to SHOULDER -->
    <link name="shoulder_link">
        <visual>
            <origin xyz="0 0 0.2" />
            <geometry>
                <cylinder length="0.4" radius="0.04" />
            </geometry>
            <material name="shoulder">
                <color rgba="0.0 0.4 0.8 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0.2" />
            <geometry>
                <cylinder length="0.4" radius="0.04" />
            </geometry>
        </collision>
        <inertial>
            <origin xyz="0 0 0.2" />
            <mass value="2" />
            <inertia ixx="0.02" iyy="0.02" izz="0.02" ixy="0" ixz="0" iyz="0" />
        </inertial>
    </link>

    <!-- SHOULDER to EBLOW -->
    <joint name="elbow_joint" type="revolute">
        <parent link="shoulder_link" />
        <child link="elbow_link" />
        <origin xyz="0 0 0.4" />
        <axis xyz="1 0 0" />
        <limit lower="0" upper="3.14" effort="300" velocity="1" />
    </joint>
    <link name="elbow_link">
        <visual>
            <origin xyz="0 0 0.2" />
            <geometry>
                <cylinder length="0.4" radius="0.035" />
            </geometry>
            <material name="elbow">
                <color rgba="0.0 0.6 0.8 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0.2" />
            <geometry>
                <cylinder length="0.4" radius="0.035" />
            </geometry>
        </collision>
        <inertial>
            <origin xyz="0 0 0.2" />
            <mass value="1.5" />
            <inertia ixx="0.015" iyy="0.015" izz="0.015" ixy="0" ixz="0" iyz="0" />
        </inertial>
    </link>

    <!-- ELBOW to FOREARM -->
    <joint name="forearm_joint" type="revolute">
        <parent link="elbow_link" />
        <child link="forearm_link" />
        <origin xyz="0 0 0.4" />
        <axis xyz="1 0 0" />
        <limit lower="-1.57" upper="1.57" effort="300" velocity="1" />
    </joint>
    <link name="forearm_link">
        <visual>
            <origin xyz="0 0 0.15" />
            <geometry>
                <cylinder length="0.3" radius="0.03" />
            </geometry>
            <material name="forearm">
                <color rgba="0.0 0.8 0.6 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0.15" />
            <geometry>
                <cylinder length="0.3" radius="0.03" />
            </geometry>
        </collision>
        <inertial>
            <origin xyz="0 0 0.15" />
            <mass value="1" />
            <inertia ixx="0.01" iyy="0.01" izz="0.01" ixy="0" ixz="0" iyz="0" />
        </inertial>
    </link>

    <!-- FOREARM to WRIST PITCH -->
    <joint name="wrist_pitch_joint" type="revolute">
        <parent link="forearm_link" />
        <child link="wrist_pitch_link" />
        <origin xyz="0 0 0.3" />
        <axis xyz="1 0 0" />
        <limit lower="-1.57" upper="1.57" effort="100" velocity="1" />
    </joint>
    <link name="wrist_pitch_link">
        <visual>
            <origin xyz="0 0 0.04" />
            <geometry>
                <cylinder length="0.08" radius="0.025" />
            </geometry>
            <material name="wrist_pitch">
                <color rgba="0.8 0.8 0.0 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0.04" />
            <geometry>
                <cylinder length="0.08" radius="0.025" />
            </geometry>
        </collision>
        <inertial>
            <origin xyz="0 0 0.04" />
            <mass value="0.4" />
            <inertia ixx="0.002" iyy="0.002" izz="0.002" ixy="0" ixz="0" iyz="0" />
        </inertial>
    </link>

    <!-- WRIST PITCH to WRIST ROLL -->
    <joint name="wrist_roll_joint" type="revolute">
        <parent link="wrist_pitch_link" />
        <child link="wrist_roll_link" />
        <origin xyz="0 0 0.08" />
        <axis xyz="0 0 1" />
        <limit lower="-3.14" upper="3.14" effort="50" velocity="2" />
    </joint>
    <link name="wrist_roll_link">
        <visual>
            <origin xyz="0 0 0.03" />
            <geometry>
                <cylinder length="0.06" radius="0.022" />
            </geometry>
            <material name="wrist_roll">
                <color rgba="0.9 0.6 0.0 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0.03" />
            <geometry>
                <cylinder length="0.06" radius="0.022" />
            </geometry>
        </collision>
        <inertial>
            <origin xyz="0 0 0.03" />
            <mass value="0.3" />
            <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0" ixz="0" iyz="0" />
        </inertial>
    </link>

    <!-- WRIST ROLL to GRIPPER BASE -->
    <joint name="gripper_mount_joint" type="fixed">
        <parent link="wrist_roll_link" />
        <child link="gripper_base" />
        <origin xyz="0 0 0.06" />
    </joint>
    <link name="gripper_base">
        <visual>
            <origin xyz="0 0 0.05" />
            <geometry>
                <box size="0.08 0.08 0.1" />
            </geometry>
            <material name="gripper">
                <color rgba="0.5 0.5 0.5 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0.05" />
            <geometry>
                <box size="0.08 0.08 0.1" />
            </geometry>
        </collision>
        <inertial>
            <origin xyz="0 0 0.05" />
            <mass value="0.4" />
            <inertia ixx="0.002" iyy="0.002" izz="0.002" ixy="0" ixz="0" iyz="0" />
        </inertial>
    </link>

    <!-- GRIPPER BASE to CAMERA -->
    <joint name="camera_joint" type="fixed">
        <parent link="gripper_base" />
        <child link="camera_link" />
        <origin xyz="0 0 0.08" rpy="0 -1.57 0" />
    </joint>
    <link name="camera_link">
        <visual>
            <geometry>
                <box size="0.04 0.04 0.04" />
            </geometry>
            <material name="black">
                <color rgba="0 0 0 1" />
            </material>
        </visual>
    </link>

    <!-- GRIPPER BASE to LEFT FINGER -->
    <joint name="left_finger_joint" type="prismatic">
        <parent link="gripper_base" />
        <child link="left_finger" />
        <origin xyz="0 0.012 0.05" />
        <axis xyz="0 1 0" />
        <limit lower="0" upper="0.025" effort="100" velocity="0.2" />
    </joint>
    <link name="left_finger">
        <visual>
            <origin xyz="0 0 0.05" />
            <geometry>
                <box size="0.015 0.015 0.1" />
            </geometry>
            <material name="finger">
                <color rgba="0.2 0.2 0.2 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0.05" />
            <geometry>
                <box size="0.015 0.015 0.1" />
            </geometry>
        </collision>
        <inertial>
            <origin xyz="0 0 0.05" />
            <mass value="0.05" />
            <inertia ixx="0.0002" iyy="0.0002" izz="0.0002" ixy="0" ixz="0" iyz="0" />
        </inertial>
    </link>

    <!-- GRIPPER BASE to RIGHT FINGER -->
    <joint name="right_finger_joint" type="prismatic">
        <parent link="gripper_base" />
        <child link="right_finger" />
        <origin xyz="0 -0.012 0.05" />
        <axis xyz="0 -1 0" />
        <limit lower="0" upper="0.025" effort="100" velocity="0.2" />
    </joint>
    <link name="right_finger">
        <visual>
            <origin xyz="0 0 0.05" />
            <geometry>
                <box size="0.015 0.015 0.1" />
            </geometry>
            <material name="finger">
                <color rgba="0.2 0.2 0.2 1" />
            </material>
        </visual>
        <collision>
            <origin xyz="0 0 0.05" />
            <geometry>
                <box size="0.015 0.015 0.1" />
            </geometry>
        </collision>
        <inertial>
            <origin xyz="0 0 0.05" />
            <mass value="0.05" />
            <inertia ixx="0.0002" iyy="0.0002" izz="0.0002" ixy="0" ixz="0" iyz="0" />
        </inertial>
    </link>

    <!-- CAMERA PLUGIN -->
    <gazebo reference="camera_link">
        <sensor name="camera" type="camera">
            <update_rate>30</update_rate>
            <topic>camera/image</topic>
            <camera>
                <horizontal_fov>1.396</horizontal_fov>
                <image>
                    <width>640</width>
                    <height>480</height>
                    <format>R8G8B8</format>
                </image>
            </camera>
        </sensor>
    </gazebo>
    <gazebo>
        <plugin
            filename="gz-sim-sensors-system"
            name="gz::sim::systems::Sensors">
            <render_engine>ogre2</render_engine>
        </plugin>
    </gazebo>

    <!-- ================= ROS2 CONTROL ================= -->
    <ros2_control name="nexus_ags_controller" type="system">
        <hardware>
            <plugin>gz_ros2_control/GazeboSimSystem</plugin>
        </hardware>
        <joint name="shoulder_joint">
            <command_interface name="position" />
            <state_interface name="position" />
            <state_interface name="velocity" />
        </joint>
        <joint name="elbow_joint">
            <command_interface name="position" />
            <state_interface name="position" />
            <state_interface name="velocity" />
        </joint>
        <joint name="forearm_joint">
            <command_interface name="position" />
            <state_interface name="position" />
            <state_interface name="velocity" />
        </joint>
        <joint name="wrist_pitch_joint">
            <command_interface name="position" />
            <state_interface name="position" />
            <state_interface name="velocity" />
        </joint>
        <joint name="wrist_roll_joint">
            <command_interface name="position" />
            <state_interface name="position" />
            <state_interface name="velocity" />
        </joint>
        <joint name="left_finger_joint">
            <command_interface name="position" />
            <state_interface name="position" />
            <state_interface name="velocity" />
        </joint>
        <joint name="right_finger_joint">
            <command_interface name="position" />
            <state_interface name="position" />
            <state_interface name="velocity" />
        </joint>
    </ros2_control>
    <!-- ================= GAZEBO ================= -->
    <gazebo>
        <plugin filename="libgz_ros2_control-system.so"
            name="gz_ros2_control::GazeboSimROS2ControlPlugin">
            <parameters>
                /home/madhu/ros2_nexus_ags_ws/install/ags_description/share/ags_description/config/controllers.yaml</parameters>
        </plugin>
    </gazebo>
</robot>